name: CI
on:
  - push
  - workflow_dispatch

jobs:
    ci-linux:
        runs-on: 'ubuntu-latest'
        steps:
            - uses: actions/checkout@v4
            - name: check_is_needed
              run: |
                vlt_latest_rls=$(curl -s -L \
                    -H "Accept: application/vnd.github+json" \
                    -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
                    -H "X-GitHub-Api-Version: 2022-11-28" \
                    https://api.github.com/repos/verilator/verilator/git/refs/tags | \
                    jq ".[].ref" | sed -e's%refs/tags/%%' -e 's/\"//g'| sort | tail -n 1)
                vlt_bin_latest_rls=$(curl -s -L \
                    -H "Accept: application/vnd.github+json" \
                    -H "Authorization: Bearer ${GITHUB_RELEASE_PAT}" \
                    -H "X-GitHub-Api-Version: 2022-11-28" \
                    https://api.github.com/repos/pss-hands-on/verilator-bin/releases/latest | \
                    jq ".tag_name" | sed -e 's/\"//g')
                echo "vlt_bin_latest_rls: ${vlt_bin_latest_rls}"
                echo "vlt_latest_rls: ${vlt_latest_rls}"

                echo "needed=false" >> ${GITHUB_OUTPUT}


